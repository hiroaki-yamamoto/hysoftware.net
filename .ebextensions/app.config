packages:
  rpm:
    epel:
      "http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm"
    redis:
      "http://dl.fedoraproject.org/pub/epel/7/x86_64/r/redis-2.8.19-2.el7.x86_64.rpm"

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_FACTORY: "app.settings.public.PublicConfig"
  aws:elasticbeanstalk:container:python:staticfiles:
    "/static/": "staticfiles/"
  aws:elasticbeanstalk:container:python:
    NumProcesses: 2
    NumThreads: 20
    WSGIPath: app/wsgi.py

services:
  sysvinit:
    redis:
      enabled: true
      ensureRunning: true

container_commands:
  collectstatic:
    command: "python manage.py collectstatic --noinput"
  01_syncdb:
    command: "python manage.py syncdb --noinput"
    leader_only: true
  02_migrate:
    command: "python manage.py migrate"
    leader_only: true
  99_celery:
    command: "celery worker -D -A app -B"
